const connection = require('./database');

exports.inquiry = async function (userEmail) {
    const dbData = async function () {
        // 이메일 인증번호가 있는지 없는지 위해 검색
        const con = await connection.getConnection(async conn => conn);

        try {
            const [row] = await con.query('select userEmail, authNumber from auth where userEmail = ?', userEmail);
            con.release();
            return row;
        } catch (err) {
            console.log(err);
            return false;
        }
    };

    const data = await dbData();
    return data;
};

exports.authEmail = async function (userEmail, random) {
    const dbInsert = async function () {
        // 인증번호가 없다면 인증번호 insert
        const con = await connection.getConnection(async conn => conn);
        try {
            const [row] = await con.query('insert into auth (userEmail, authNumber, registration) values (?,?,now())', [userEmail, random]);
            con.release();
            return row;
        } catch (err) {
            console.log(err);
            return false;
        }
    };

    const data = await dbInsert();
    return data;
};
